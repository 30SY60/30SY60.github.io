<!DOCTYPE html>
<html>
  <head>
    <title>ë‚´ ì²« ì›¹í˜ì´ì§€ - ìƒìœ„ 20 ì¢…ëª©</title>
    <style>
      body {
        font-family: Arial, sans-serif;
        max-width: 900px;
        margin: 40px auto;
        padding: 0 20px;
      }
      h1 {
        color: #2c3e50;
      }
      table {
        border-collapse: collapse;
        width: 100%;
        margin-top: 20px;
      }
      th, td {
        border: 1px solid #ddd;
        padding: 8px 12px;
        text-align: center;
      }
      th {
        background-color: #3498db;
        color: white;
      }
      tr:nth-child(even) {
        background-color: #f2f2f2;
      }
      tr:hover {
        background-color: #d6eaff;
      }
      #message {
        margin-top: 20px;
        color: #555;
      }
    </style>
  </head>
  <body>
    <h1>ì•ˆë…•í•˜ì„¸ìš”! ìƒì—½ë‹˜ì˜ í™ˆí˜ì´ì§€ì…ë‹ˆë‹¤ ğŸ‰</h1>
    <div id="message">ì£¼ì‹ ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</div>

    <table id="stock-table" style="display:none;">
      <thead>
        <tr>
          <th>ì¢…ëª©ëª…</th>
          <th>í˜„ì¬ê°€</th>
          <th>ì „ì¼ë¹„</th>
          <th>ë“±ë½ë¥ (%)</th>
          <th>ê±°ë˜ëŸ‰</th>
          <th>ì™¸êµ­ì¸ë¹„ìœ¨(%)</th>
          <th>PER</th>
          <th>PBR</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>

    <script>
      // ë©”ì‹œì§€ API í˜¸ì¶œ (ê¸°ì¡´ ìœ ì§€)
      fetch('https://0f6c6601e158.ngrok-free.app/api/message', {
        headers: {
          'ngrok-skip-browser-warning': 'true'
        }
      })
        .then(res => res.json())
        .then(data => {
          console.log('ë©”ì‹œì§€:', data.message);
        })
        .catch(err => {
          console.error('ë©”ì‹œì§€ API ì˜¤ë¥˜:', err);
        });

      // ìƒìœ„ 20ê°œ ì¢…ëª© ë°ì´í„° API í˜¸ì¶œ ë° í‘œ ì¶œë ¥
      fetch('https://0f6c6601e158.ngrok-free.app/api/top20', {
        headers: {
          'ngrok-skip-browser-warning': 'true'
        }
      })
        .then(res => res.json())
        .then(data => {
          if (!Array.isArray(data) || data.length === 0) {
            document.getElementById('message').textContent = 'ìƒìœ„ 20ê°œ ì¢…ëª© ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ì§€ ëª»í–ˆìŠµë‹ˆë‹¤.';
            return;
          }

          const tbody = document.querySelector('#stock-table tbody');
          tbody.innerHTML = ''; // ì´ˆê¸°í™”

          data.forEach(item => {
            const tr = document.createElement('tr');

            // ë“±ë½ë¥  %ë¡œ ë°”ê¾¸ê¸° (ì˜ˆ: 1.23 -> 1.23%)
            // ì™¸êµ­ì¸ë¹„ìœ¨ë„ %ë¡œ í‘œê¸° (ìˆìœ¼ë©´)
            tr.innerHTML = `
              <td>${item['ì¢…ëª©ëª…']}</td>
              <td>${item['í˜„ì¬ê°€']}</td>
              <td>${item['ì „ì¼ë¹„']}</td>
              <td>${item['ë“±ë½ë¥ ']}</td>
              <td>${item['ê±°ë˜ëŸ‰'].toLocaleString()}</td>
              <td>${item['ì™¸êµ­ì¸ë¹„ìœ¨'] ? item['ì™¸êµ­ì¸ë¹„ìœ¨'] : '-'}</td>
              <td>${item['PER'] ? item['PER'] : '-'}</td>
              <td>${item['PBR'] ? item['PBR'] : '-'}</td>
            `;
            tbody.appendChild(tr);
          });

          document.getElementById('message').style.display = 'none';
          document.getElementById('stock-table').style.display = 'table';
        })
        .catch(err => {
          document.getElementById('message').textContent = 'ì£¼ì‹ ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.';
          console.error('ì£¼ì‹ ë°ì´í„° ì˜¤ë¥˜:', err);
        });
    </script>
  </body>
</html>